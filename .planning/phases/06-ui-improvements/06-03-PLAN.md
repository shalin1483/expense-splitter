---
phase: 06-ui-improvements
plan: "03"
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/BillWizard.tsx
autonomous: true

must_haves:
  truths:
    - "A progress bar replaces the text 'Step N of 5' at the top of the wizard"
    - "The progress bar advances from 20% to 100% as the user moves through steps"
    - "Stepping forward slides the new step in from the right"
    - "Stepping backward slides the new step in from the left"
    - "The animation duration is short (200ms) and does not block interaction"
    - "The wizard still navigates correctly (Next/Back buttons, validation gates)"
  artifacts:
    - path: "src/components/BillWizard.tsx"
      provides: "Wizard with AnimatePresence transitions and shadcn Progress bar"
      contains: "AnimatePresence"
  key_links:
    - from: "src/components/BillWizard.tsx"
      to: "motion/react"
      via: "AnimatePresence + motion.div wrapping step content"
      pattern: "AnimatePresence"
    - from: "src/components/BillWizard.tsx"
      to: "src/components/ui/progress.tsx"
      via: "import { Progress }"
      pattern: "Progress"
---

<objective>
Upgrade BillWizard.tsx with two visual improvements: replace the text step indicator with a shadcn/ui Progress bar, and add directional slide animations between wizard steps using motion AnimatePresence.

Purpose: The wizard is the core UX pattern of the app. The progress bar gives users a clear sense of location; the slide animation makes step transitions feel native. Both changes live entirely in BillWizard.tsx — zero impact on step components.

Output: src/components/BillWizard.tsx updated with Progress + AnimatePresence. No other files touched.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ui-improvements/06-RESEARCH.md
@.planning/phases/06-ui-improvements/06-01-SUMMARY.md
@src/components/BillWizard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Progress bar and directional AnimatePresence transitions to BillWizard</name>
  <files>src/components/BillWizard.tsx</files>
  <action>
Replace the entire contents of `src/components/BillWizard.tsx` with the following. Key changes from current:
1. Import Progress from @/components/ui/progress and AnimatePresence + motion from motion/react
2. Track `direction` state (1 = forward, -1 = backward) updated in handleNext/handleBack before calling setCurrentStep
3. Replace `.wizard-progress` text div with `<Progress>` component
4. Wrap the step content area with `<AnimatePresence mode="wait" custom={direction}>` and `<motion.div>` with slide variants
5. Apply Tailwind classes to wizard nav buttons (replacing CSS class-based styles)

```tsx
import { useState, useEffect } from 'react';
import { AnimatePresence, motion } from 'motion/react';
import { usePeople, useItems, useAssignments } from '@/stores/billStore';
import { PeopleStep, canProceedFromPeople } from '@/components/PeopleStep';
import { ItemsStep, canProceedFromItems } from '@/components/ItemsStep';
import { AssignmentStep, canProceedFromAssignment } from '@/components/AssignmentStep';
import { TaxTipStep } from '@/components/TaxTipStep';
import { ResultsStep } from '@/components/ResultsStep';
import { Progress } from '@/components/ui/progress';

type WizardStep = 'people' | 'items' | 'assignment' | 'taxtip' | 'results';

const STEPS: readonly WizardStep[] = ['people', 'items', 'assignment', 'taxtip', 'results'] as const;

const stepLabels: Record<WizardStep, string> = {
  people: 'People',
  items: 'Items',
  assignment: 'Assign Items',
  taxtip: 'Tax & Tip',
  results: 'Results',
};

// Slide variants: custom(dir) = direction (1=forward, -1=back)
const stepVariants = {
  enter: (dir: number) => ({ x: dir * 40, opacity: 0 }),
  center: { x: 0, opacity: 1 },
  exit: (dir: number) => ({ x: dir * -40, opacity: 0 }),
};

export function BillWizard() {
  const [currentStep, setCurrentStep] = useState<WizardStep>('people');
  const [direction, setDirection] = useState(1); // 1=forward, -1=backward
  const people = usePeople();
  const items = useItems();
  const assignments = useAssignments();

  // Compute validation gates
  const canProceed: Record<WizardStep, boolean> = {
    people: canProceedFromPeople(people),
    items: canProceedFromItems(items),
    assignment: canProceedFromAssignment(items, assignments),
    taxtip: true,
    results: true,
  };

  // Auto-advance on mount to furthest incomplete step
  useEffect(() => {
    const hasAssignments = items.some(item => {
      const assignment = assignments[item.id];
      return assignment && assignment.personIds.length > 0;
    });

    if (people.length >= 2 && items.length >= 1 && hasAssignments) {
      setCurrentStep('taxtip');
    } else if (people.length >= 2 && items.length >= 1) {
      setCurrentStep('assignment');
    } else if (people.length >= 2) {
      setCurrentStep('items');
    }
  }, []);

  const handleNext = () => {
    if (!canProceed[currentStep]) return;
    const currentIndex = STEPS.indexOf(currentStep);
    if (currentIndex < STEPS.length - 1) {
      setDirection(1);
      setCurrentStep(STEPS[currentIndex + 1]);
    }
  };

  const handleBack = () => {
    const currentIndex = STEPS.indexOf(currentStep);
    if (currentIndex > 0) {
      setDirection(-1);
      setCurrentStep(STEPS[currentIndex - 1]);
    }
  };

  const currentIndex = STEPS.indexOf(currentStep);
  const isFirstStep = currentIndex === 0;
  const isLastStep = currentIndex === STEPS.length - 1;
  const progressValue = ((currentIndex + 1) / STEPS.length) * 100;

  return (
    <div>
      {/* Progress bar replacing text step indicator */}
      <div className="mb-4">
        <div className="flex justify-between items-center mb-1.5">
          <span className="text-xs text-zinc-500 dark:text-zinc-400 font-medium">
            Step {currentIndex + 1} of {STEPS.length}
          </span>
          <span className="text-xs text-zinc-500 dark:text-zinc-400 font-medium">
            {stepLabels[currentStep]}
          </span>
        </div>
        <Progress value={progressValue} className="h-1.5" />
      </div>

      {/* Animated step content */}
      <AnimatePresence mode="wait" custom={direction}>
        <motion.div
          key={currentStep}
          custom={direction}
          variants={stepVariants}
          initial="enter"
          animate="center"
          exit="exit"
          transition={{ duration: 0.2, ease: 'easeInOut' }}
        >
          {currentStep === 'people' && <PeopleStep />}
          {currentStep === 'items' && <ItemsStep />}
          {currentStep === 'assignment' && <AssignmentStep />}
          {currentStep === 'taxtip' && <TaxTipStep />}
          {currentStep === 'results' && <ResultsStep />}
        </motion.div>
      </AnimatePresence>

      {/* Navigation buttons */}
      <div className="flex justify-between mt-6 pt-4 border-t border-zinc-200 dark:border-zinc-800">
        <button
          onClick={handleBack}
          disabled={isFirstStep}
          className="min-w-[100px] px-4 py-3 text-base rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors active:scale-95"
        >
          Back
        </button>
        {!isLastStep && (
          <button
            onClick={handleNext}
            disabled={!canProceed[currentStep]}
            className="min-w-[100px] px-4 py-3 text-base rounded-md bg-brand text-white hover:bg-brand-hover disabled:opacity-40 disabled:cursor-not-allowed transition-colors active:scale-95"
          >
            {currentStep === 'taxtip' ? 'See Results' : 'Next'}
          </button>
        )}
      </div>
    </div>
  );
}
```

Important implementation notes:
- `direction` state is set BEFORE `setCurrentStep` so the `custom` prop on motion.div reads the correct direction during the exit animation of the old step
- `mode="wait"` ensures the exit animation completes before enter begins — prevents overlap
- Only animate `x` (transform) and `opacity` — never `width`/`height` which cause layout thrash on mobile
- `active:scale-95` provides haptic-like tap feedback on mobile
  </action>
  <verify>
Run: `npm run build 2>&1 | tail -20`
Expected: Build succeeds, no TypeScript errors.
Run: `npx vitest run src/components/BillWizard.test.tsx 2>&1 | tail -20`
Expected: BillWizard tests pass. (Tests that assert step content renders are not affected by AnimatePresence wrapping since motion renders the children synchronously in test environment.)
  </verify>
  <done>BillWizard.tsx renders Progress bar and AnimatePresence-wrapped steps. Build succeeds. BillWizard.test.tsx passes.</done>
</task>

</tasks>

<verification>
1. `npm run build` exits 0
2. `npx vitest run src/components/BillWizard.test.tsx` passes
3. `grep "AnimatePresence" src/components/BillWizard.tsx` returns a match
4. `grep "Progress" src/components/BillWizard.tsx` returns a match
5. `grep "wizard-progress" src/components/BillWizard.tsx` returns nothing (old class removed)
</verification>

<success_criteria>
- BillWizard.tsx imports and uses AnimatePresence + motion.div from motion/react
- BillWizard.tsx uses shadcn/ui Progress component showing (currentIndex+1)/5 * 100% fill
- direction state (1 or -1) drives custom prop on variants so forward slides right-to-left and back slides left-to-right
- Nav buttons use Tailwind utility classes (no .wizard-nav CSS class dependency)
- All BillWizard tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-ui-improvements/06-03-SUMMARY.md` following the summary template.
</output>
