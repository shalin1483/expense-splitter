---
phase: 06-ui-improvements
plan: "06"
type: execute
wave: 5
depends_on: ["06-05"]
files_modified:
  - src/components/ResultsStep.tsx
  - src/components/HistoryList.tsx
autonomous: true

must_haves:
  truths:
    - "ResultsStep renders with Tailwind classes — no old CSS classes (.results-step, .bill-overview, .person-total)"
    - "Saving to history fires a toast notification ('Split saved to history!') instead of showing inline 'Saved!' text"
    - "The isSaved state and setTimeout can be removed — sonner handles its own dismiss timing"
    - "Person total cards expand/collapse with native details/summary styled with Tailwind"
    - "HistoryList renders with Tailwind classes — no old CSS classes (.history-item, .history-header, .clear-history-btn)"
    - "History item delete and clear all buttons are clearly styled"
    - "All ResultsStep and HistoryList tests pass"
  artifacts:
    - path: "src/components/ResultsStep.tsx"
      provides: "ResultsStep with Tailwind classes and sonner toast on save"
      contains: "toast.success"
    - path: "src/components/HistoryList.tsx"
      provides: "HistoryList with Tailwind classes"
      contains: "dark:"
  key_links:
    - from: "src/components/ResultsStep.tsx"
      to: "sonner"
      via: "import { toast } from 'sonner'; toast.success('Split saved to history!')"
      pattern: "toast.success"
    - from: "src/components/ResultsStep.tsx"
      to: "historyStore"
      via: "historyActions.saveBill(billData)"
      pattern: "saveBill"
---

<objective>
Migrate ResultsStep.tsx and HistoryList.tsx to Tailwind, and replace the inline "Saved!" button feedback in ResultsStep with a sonner toast notification.

Purpose: This is the final component migration. ResultsStep also delivers the toast notification feature (success criterion 5) — replacing the current isSaved state + setTimeout pattern with a single toast.success() call. HistoryList gets consistent Tailwind styling matching the rest of the app.

Output: ResultsStep.tsx fully Tailwind-styled with toast.success on save. HistoryList.tsx fully Tailwind-styled. Both components dark-mode aware.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claire/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ui-improvements/06-RESEARCH.md
@.planning/phases/06-ui-improvements/06-05-SUMMARY.md
@src/components/ResultsStep.tsx
@src/components/HistoryList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ResultsStep to Tailwind and replace inline save feedback with sonner toast</name>
  <files>src/components/ResultsStep.tsx</files>
  <action>
Read the current ResultsStep.tsx fully, then rewrite with Tailwind utility classes AND the toast migration.

Key changes:
1. Add `import { toast } from 'sonner';` at the top
2. Remove the `const [isSaved, setIsSaved] = useState(false);` state — no longer needed
3. Remove the `setTimeout(() => setIsSaved(false), 2000)` call
4. Replace `setIsSaved(true)` with `toast.success('Split saved to history!', { duration: 2500 })`
5. The "Save to History" button is always enabled now (no disabled={isSaved})
6. Apply Tailwind classes throughout

CSS mapping to apply:

Outer wrapper (`.results-step`):
No class needed — or just `<div>`.

Empty state (`.results-empty`):
`text-center text-zinc-500 dark:text-zinc-400 py-8 px-4`

Bill overview card (`.bill-overview`):
`mb-6 p-4 bg-zinc-50 dark:bg-zinc-800 rounded-xl`

Overview row (`.overview-row`):
`flex justify-between py-1 text-[0.9375rem] text-zinc-700 dark:text-zinc-300`

Grand total row (`.overview-row.grand-total`):
`flex justify-between pt-2 mt-2 border-t border-zinc-200 dark:border-zinc-700 font-bold text-lg text-zinc-900 dark:text-zinc-50`
(implement as ternary or separate element)

Person total details element (`.person-total`):
`mb-2`

Person total summary (`.person-total__summary`):
`flex justify-between items-center min-h-[44px] px-4 py-3 cursor-pointer bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-xl user-select-none text-base list-none`

Remove webkit-details-marker via inline style or keep the CSS trick. Since App.css is gone, use a `[&::-webkit-details-marker]:hidden` Tailwind arbitrary selector or add a `<style>` block only for this. Recommended approach: add `[&::-webkit-details-marker]:hidden` to the summary's className, and use a `::before` triangle via a data attribute or simply accept the browser default triangle (it's functional).

Actually, the cleanest solution: style the summary with `marker:hidden` (which hides the default disclosure triangle in most browsers) and use a lucide ChevronRight icon that rotates when open:

```tsx
<details key={breakdown.personId} className="mb-2 group">
  <summary className="flex justify-between items-center min-h-[44px] px-4 py-3 cursor-pointer bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-xl list-none [&::-webkit-details-marker]:hidden select-none">
    <div className="flex items-center gap-2">
      <ChevronRight size={14} className="text-zinc-400 transition-transform group-open:rotate-90" />
      <span className="font-medium text-zinc-900 dark:text-zinc-50">{breakdown.personName}</span>
    </div>
    <span className="font-semibold tabular-nums text-zinc-900 dark:text-zinc-50">{formatCurrency(breakdown.total)}</span>
  </summary>
  ...
</details>
```

Import `ChevronRight` from `lucide-react`. The `group` + `group-open:rotate-90` pattern uses Tailwind's group modifier.

Person total breakdown panel (`.person-total__breakdown`):
`px-4 py-3 -mt-px border border-zinc-200 dark:border-zinc-700 border-t-0 rounded-b-xl bg-zinc-50 dark:bg-zinc-800`

Breakdown item row (`.breakdown-item`):
`flex justify-between py-1 text-sm text-zinc-700 dark:text-zinc-300`

Split indicator (`.split-indicator`):
`text-zinc-400 dark:text-zinc-500 text-xs ml-1`

Share line (`.share-line`):
`flex justify-between py-1 text-sm text-zinc-500 dark:text-zinc-400`

Total line (`.total-line`):
`flex justify-between pt-2 mt-2 border-t border-zinc-200 dark:border-zinc-700 font-semibold text-zinc-900 dark:text-zinc-50`

Results actions row (`.results-actions`):
`flex gap-3 mt-6`

Save to History button (`.save-history-btn`) — note: no longer has disabled/saved states:
`flex-1 px-4 py-3 text-base rounded-xl bg-success text-white hover:bg-success/90 transition-colors active:scale-95`

New Split button (`.new-split-btn`):
`flex-1 px-4 py-3 text-base rounded-xl bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors active:scale-95`

Full handleSaveToHistory after migration:
```tsx
const handleSaveToHistory = () => {
  const billData = {
    people,
    items,
    assignments,
    taxInput,
    tipRate,
    totalInCents: summary.grandTotal,
  };
  historyActions.saveBill(billData);
  toast.success('Split saved to history!', { duration: 2500 });
};
```
  </action>
  <verify>
Run: `npx vitest run src/components/ResultsStep.test.tsx 2>&1 | tail -20`
Expected: All ResultsStep tests pass. (Tests mock toast or don't check for the inline "Saved!" text — if any test asserts isSaved state, update the test to check for toast mock call instead.)
Run: `grep "toast.success" src/components/ResultsStep.tsx`
Expected: Returns a match.
Run: `grep "isSaved" src/components/ResultsStep.tsx`
Expected: No matches (isSaved state removed).
  </verify>
  <done>ResultsStep.tsx uses Tailwind classes. toast.success() fires on save. isSaved state removed. All tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate HistoryList to Tailwind</name>
  <files>src/components/HistoryList.tsx</files>
  <action>
Read the current HistoryList.tsx fully, then rewrite JSX with Tailwind utility classes. Preserve ALL logic unchanged.

CSS mapping to apply:

Outer wrapper (`.history-list`):
No class (or just `<div>`)

History header row (`.history-header`):
`flex justify-between items-center mb-4`

Header h2:
`text-xl font-semibold text-zinc-900 dark:text-zinc-50`

Back button in header:
`px-3 py-2 text-sm rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors min-h-[36px]`

Empty state (`.history-empty`):
`text-center text-zinc-500 dark:text-zinc-400 py-8 px-4`

History item details element (`.history-item`):
`mb-2 group`

History item summary (`.history-item__summary`):
`flex justify-between items-center min-h-[44px] px-4 py-3 cursor-pointer bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-xl list-none [&::-webkit-details-marker]:hidden select-none hover:bg-zinc-50 dark:hover:bg-zinc-800`

History meta text (`.history-meta`):
`text-sm text-zinc-500 dark:text-zinc-400`

First .history-meta (date): `text-sm font-medium text-zinc-800 dark:text-zinc-200`

Delete button (`.history-delete-btn`):
`px-2 py-1 text-xs rounded-md bg-transparent text-danger hover:bg-danger-light dark:hover:bg-danger/10 transition-colors min-h-[32px] min-w-[32px]`

History item details panel (`.history-item__details`):
`px-4 py-3 -mt-px border border-zinc-200 dark:border-zinc-700 border-t-0 rounded-b-xl bg-zinc-50 dark:bg-zinc-800 text-sm text-zinc-700 dark:text-zinc-300`

Inside the details panel, replace all inline `style={{ ... }}` with Tailwind classes:
- `style={{ marginTop: '8px' }}` → className="mt-2"
- `style={{ marginTop: '12px' }}` → className="mt-3"
- `style={{ fontWeight: 'bold' }}` → className="font-bold"
- `style={{ fontWeight: '500' }}` → className="font-medium"
- `style={{ marginLeft: '16px', fontSize: '0.875rem' }}` → className="ml-4 text-sm"
- `style={{ color: '#666' }}` → className="text-zinc-500 dark:text-zinc-400"
- `style={{ fontSize: '0.875rem', color: '#666' }}` → className="text-sm text-zinc-500 dark:text-zinc-400"

Bill total summary lines in details:
```tsx
<div className="mt-2 space-y-0.5">
  <div className="flex justify-between"><span>Subtotal</span><span>{formatCurrency(summary.billSubtotal)}</span></div>
  <div className="flex justify-between"><span>Tax</span><span>{formatCurrency(summary.totalTax)}</span></div>
  <div className="flex justify-between"><span>Tip</span><span>{formatCurrency(summary.totalTip)}</span></div>
  <div className="flex justify-between font-bold mt-1 pt-1 border-t border-zinc-200 dark:border-zinc-700">
    <span>Grand Total</span><span>{formatCurrency(summary.grandTotal)}</span>
  </div>
</div>
```

Clear All History button (`.clear-history-btn`):
- Normal state: `w-full mt-4 px-4 py-3 text-sm rounded-xl bg-zinc-100 dark:bg-zinc-800 text-danger hover:bg-danger-light dark:hover:bg-danger/10 transition-colors`
- Confirming state: `w-full mt-4 px-4 py-3 text-sm rounded-xl bg-danger text-white hover:bg-danger/90 transition-colors`

Implement with ternary:
```tsx
className={`w-full mt-4 px-4 py-3 text-sm rounded-xl transition-colors ${
  confirmingClear
    ? 'bg-danger text-white hover:bg-danger/90'
    : 'bg-zinc-100 dark:bg-zinc-800 text-danger hover:bg-danger-light dark:hover:bg-danger/10'
}`}
```
  </action>
  <verify>
Run: `npx vitest run src/components/HistoryList.test.tsx 2>&1 | tail -20`
Expected: All HistoryList tests pass.
Run: `grep -E "className=\"[^\"]*history-item|className=\"[^\"]*history-header|className=\"[^\"]*clear-history" src/components/HistoryList.tsx`
Expected: No matches (old CSS class names removed).
Run: `grep "style={{" src/components/HistoryList.tsx`
Expected: No matches (all inline styles replaced with Tailwind).
  </verify>
  <done>HistoryList.tsx uses only Tailwind classes. No inline styles. All HistoryList tests pass.</done>
</task>

</tasks>

<verification>
1. `npx vitest run src/components/ResultsStep.test.tsx src/components/HistoryList.test.tsx` — all tests pass
2. `npm run build` exits 0
3. `grep "toast.success" src/components/ResultsStep.tsx` — returns match
4. `grep "isSaved" src/components/ResultsStep.tsx` — no matches
5. `grep "style={{" src/components/HistoryList.tsx` — no matches
6. `grep "history-item\|history-header\|results-step\|bill-overview\|person-total" src/components/ResultsStep.tsx src/components/HistoryList.tsx` — no matches
</verification>

<success_criteria>
- ResultsStep.tsx: Tailwind styled, toast.success fires on save, isSaved useState removed, ChevronRight icon rotates on expand, dark: variants present, all tests pass
- HistoryList.tsx: Tailwind styled, no inline styles, dark: variants present, confirming state uses ternary, all tests pass
- npm run build exits 0
- npm test exits 0 (all 28+ tests pass across the entire project)
</success_criteria>

<output>
After completion, create `.planning/phases/06-ui-improvements/06-06-SUMMARY.md` following the summary template.
</output>
