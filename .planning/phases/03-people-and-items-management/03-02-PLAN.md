---
phase: 03-people-and-items-management
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ItemsStep.tsx
  - src/components/ItemsStep.test.tsx
  - src/components/BillWizard.tsx
  - src/components/BillWizard.test.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "User can add items with name and dollar amount"
    - "Mobile decimal keyboard appears for price input"
    - "User can remove an item from the list"
    - "Wizard prevents proceeding from People step without 2+ people"
    - "Wizard allows navigating back and forward between People and Items steps"
  artifacts:
    - path: "src/components/ItemsStep.tsx"
      provides: "Items add/remove form with mobile-optimized price input"
      exports: ["ItemsStep", "canProceedFromItems"]
      min_lines: 50
    - path: "src/components/BillWizard.tsx"
      provides: "Wizard container coordinating People and Items steps with validation gates"
      exports: ["BillWizard"]
      min_lines: 40
    - path: "src/components/BillWizard.test.tsx"
      provides: "Wizard validation gate tests"
      min_lines: 15
    - path: "src/components/ItemsStep.test.tsx"
      provides: "Items validation and price conversion tests"
      min_lines: 15
  key_links:
    - from: "src/components/ItemsStep.tsx"
      to: "src/stores/billStore.ts"
      via: "useItems and useBillActions hooks"
      pattern: "useItems|useBillActions"
    - from: "src/components/ItemsStep.tsx"
      to: "src/lib/types/money.ts"
      via: "Dollar to cents conversion on submit"
      pattern: "Math\\.round.*\\*.*100"
    - from: "src/components/BillWizard.tsx"
      to: "src/components/PeopleStep.tsx"
      via: "Imports canProceedFromPeople for validation gate"
      pattern: "canProceedFromPeople"
    - from: "src/components/BillWizard.tsx"
      to: "src/components/ItemsStep.tsx"
      via: "Imports canProceedFromItems for validation gate"
      pattern: "canProceedFromItems"
    - from: "src/components/BillWizard.tsx"
      to: "src/stores/billStore.ts"
      via: "usePeople and useItems for reactive validation"
      pattern: "usePeople|useItems"
---

<objective>
Implement the Items management step and BillWizard container that orchestrates the linear People -> Items flow with validation gates.

Purpose: This plan completes Phase 3 by adding the Items step (add/remove items with mobile-optimized price input) and the wizard navigation that enforces the linear flow. The wizard prevents proceeding from People step without 2+ people and coordinates step transitions. Future phases (4, 5) will add more steps to this wizard.

Output: A working wizard flow: People step (add 2+ people) -> Next -> Items step (add items with prices) with Back/Next navigation and validation gates.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-people-and-items-management/03-RESEARCH.md
@.planning/phases/03-people-and-items-management/03-01-SUMMARY.md
@src/stores/billStore.ts
@src/lib/types/bill.ts
@src/lib/types/money.ts
@src/components/PeopleStep.tsx
@src/App.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement ItemsStep component with mobile-optimized price input</name>
  <files>
    src/components/ItemsStep.tsx
    src/components/ItemsStep.test.tsx
  </files>
  <action>
Create `src/components/ItemsStep.tsx`:
- Import useState from React
- Import useItems and useBillActions from @/stores/billStore
- Import type Item from @/lib/types/bill
- Import formatCurrency from @/lib/types/money (for displaying item prices)
- Export named function component ItemsStep
- Two local useState values: itemName (string, '') and priceString (string, '')
  (Keep draft values local, NOT in Zustand -- same pattern as PeopleStep)
- Form with two inputs and onSubmit handler:
  1. preventDefault
  2. Trim itemName
  3. Parse priceString with parseFloat
  4. Validate: return early if trimmedName is empty OR isNaN(priceNum) OR priceNum <= 0
  5. Convert dollars to cents: Math.round(priceNum * 100) -- CRITICAL: always Math.round to avoid floating-point errors (e.g., 12.99 * 100 = 1298.9999...)
  6. Call addItem(trimmedName, priceInCents)
  7. Clear both inputs
- Item name input: type="text", autoFocus, placeholder="Item name (e.g., Caesar Salad)", required
- Price input: type="number", inputMode="decimal", step="0.01", min="0", placeholder="0.00", required
  - inputMode="decimal" triggers decimal numeric keypad on mobile (research Pattern 2)
  - step="0.01" signals decimal input is allowed
  - min="0" prevents negative values
  - font-size must be 16px (inherited from App.css) to prevent iOS zoom on focus
- Submit button text: "Add"
- Items list from useItems() selector: ul with li items keyed by item.id
  - span for item.name
  - span for formatCurrency(item.priceInCents) displaying price as "$12.99" format
  - button with className="remove-btn", onClick={() => removeItem(item.id)}, aria-label={`Remove ${item.name}`}, text "\u00D7"
- Show total at bottom if items exist: sum all item.priceInCents, display with formatCurrency
- Export standalone pure helper: export function canProceedFromItems(items: Item[]): boolean { return items.length >= 1; }

Create `src/components/ItemsStep.test.tsx`:
- Import describe, it, expect from vitest
- Import canProceedFromItems from @/components/ItemsStep
- Test suite "canProceedFromItems":
  - false for empty array
  - true for 1 item
  - true for multiple items
- Test suite "price conversion edge cases" (pure math, no React):
  - Math.round(12.99 * 100) === 1299 (known floating-point pitfall)
  - Math.round(0.29 * 100) === 29
  - Math.round(0.01 * 100) === 1
  - Math.round(100.00 * 100) === 10000
  </action>
  <verify>
1. `npm test` -- all tests pass (108 existing + ~7 new ItemsStep tests)
2. `npx tsc --noEmit` -- 0 errors
3. Inspect component file to confirm: inputMode="decimal", step="0.01", Math.round conversion
  </verify>
  <done>
ItemsStep renders with mobile-optimized price input (inputMode="decimal"), validates input, converts dollars to cents with Math.round, displays items with formatted prices, supports remove. canProceedFromItems exported and tested. Price conversion edge cases verified.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement BillWizard container with step navigation and validation gates</name>
  <files>
    src/components/BillWizard.tsx
    src/components/BillWizard.test.tsx
    src/App.tsx
    src/App.css
  </files>
  <action>
Create `src/components/BillWizard.tsx`:
- Import useState from React
- Import usePeople and useItems from @/stores/billStore
- Import PeopleStep and canProceedFromPeople from @/components/PeopleStep
- Import ItemsStep and canProceedFromItems from @/components/ItemsStep
- Define WizardStep type: 'people' | 'items' (Phase 4 will add 'assign' | 'tax-tip', Phase 5 will add 'results')
- Define STEPS array: ['people', 'items'] as const (extensible for future phases)
- Define step labels map: { people: 'People', items: 'Items' }
- Export named function component BillWizard
- useState for currentStep initialized to 'people'
- Get people from usePeople() and items from useItems()
- Compute validation gates reactively:
  - canProceed: { people: canProceedFromPeople(people), items: canProceedFromItems(items) }
- Auto-advance on mount: useEffect that checks if people.length >= 2 and currentStep is 'people', auto-advance to 'items'. This handles page refresh where Zustand rehydrates people but wizard resets to step 1. (Research Pitfall 5 recommendation: auto-advance to first incomplete step)
- handleNext: if canProceed[currentStep], advance to next step in STEPS array
- handleBack: go to previous step in STEPS array
- Render structure:
  1. Progress indicator: div with className="wizard-progress" showing "Step {currentIndex + 1} of {STEPS.length}: {stepLabels[currentStep]}"
  2. Step content: conditionally render PeopleStep or ItemsStep based on currentStep
  3. Navigation bar: div with className="wizard-nav" containing:
     - Back button: disabled when currentStep === STEPS[0], text "Back"
     - Next button: disabled when !canProceed[currentStep] or currentStep is last step, text "Next"
     - When on last step ('items' for now), Next button shows "Next" but is disabled (Phase 4 will enable it)

Add to `src/App.css` (append, do not overwrite):
- .wizard-progress: text-align center, padding 8px 0, margin-bottom 1rem, font-size 0.875rem, color #666, border-bottom 1px solid #eee
- .wizard-nav: display flex, justify-content space-between, margin-top 1.5rem, padding-top 1rem, border-top 1px solid #eee
- .wizard-nav button: flex none (override form button flex), min-width 100px
- .item-row: display flex, gap 8px, align-items center (for items with name + price + remove)
- .item-price: font-variant-numeric tabular-nums, white-space nowrap
- .items-total: text-align right, font-weight bold, margin-top 0.5rem, padding-top 0.5rem, border-top 1px solid #ccc

Update `src/App.tsx`:
- Replace PeopleStep import/render with BillWizard import/render
- Import BillWizard from @/components/BillWizard
- Render BillWizard inside main below h1

Create `src/components/BillWizard.test.tsx`:
- Import describe, it, expect from vitest
- Test the validation gate logic as pure functions (no React rendering):
  - Test canProceedFromPeople(people) && canProceedFromItems(items) combinations
  - Test that STEPS array ordering is correct: ['people', 'items']
  - Test step index calculations: currentIndex logic for progress display
- Import canProceedFromPeople from PeopleStep and canProceedFromItems from ItemsStep
- Test combined wizard validation scenarios:
  - 0 people, 0 items: can proceed from people = false
  - 2 people, 0 items: people = true, items = false
  - 2 people, 1 item: both true
  - 1 person, 1 item: people = false (blocks even if items exist)
  </action>
  <verify>
1. `npm test` -- all tests pass (previous + new BillWizard tests)
2. `npx tsc --noEmit` -- 0 errors
3. Browser at localhost:5173:
   - App shows "Step 1 of 2: People" progress indicator
   - PeopleStep is visible, Next button is disabled
   - Add 2 people -- Next button becomes enabled
   - Click Next -- transitions to "Step 2 of 2: Items" showing ItemsStep
   - Click Back -- returns to People step with people still listed
   - On Items step: add item with name and price, price shows formatted
   - Refresh page with 2+ people: auto-advances to Items step
  </verify>
  <done>
BillWizard coordinates People -> Items flow. Validation gates prevent advancing without 2+ people. Back/Next navigation works. Auto-advances past completed steps on refresh. All tests pass.
  </done>
</task>

</tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete wizard flow on mobile viewport</name>
  <what-built>Complete People -> Items wizard flow with validation gates, mobile-optimized inputs, and localStorage persistence</what-built>
  <how-to-verify>
1. Open http://localhost:5173 in browser (run `npm run dev` if not running)
2. Open browser DevTools and toggle mobile viewport (e.g., iPhone SE or 375px width)
3. Verify People step:
   - Input is auto-focused
   - Type "Alice" and press Enter -- Alice appears with remove button
   - Type "Bob" and press Enter -- Bob appears, message changes to "2 people added"
   - Next button is now enabled (was disabled before)
4. Click Next -- transitions to Items step with "Step 2 of 2: Items"
5. Verify Items step:
   - Tap the price input -- mobile numeric keypad should appear (with decimal point)
   - Type item name "Pizza" and price "12.99", click Add
   - Item shows as "Pizza $12.99" in list
   - Add another item "Salad" for "8.50"
   - Total shows "$21.49" at bottom
   - Remove "Salad" -- total updates to "$12.99"
6. Click Back -- returns to People step, Alice and Bob still listed
7. Refresh the page -- should auto-advance to Items step (people persist, wizard detects >= 2 people)
8. Touch targets are at least 44px (buttons and inputs are tappable without precision)
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

<verification>
1. `npm test` passes all tests (108 + ~11 new = ~119 total)
2. `npx tsc --noEmit` compiles with 0 errors
3. Full wizard flow works: People (add 2+) -> Next -> Items (add with prices) -> Back
4. Mobile decimal keyboard appears for price input
5. Validation gates prevent advancing without minimum people
6. Auto-advance on refresh works correctly
7. All prices convert correctly to integer cents (Math.round)
8. Items display with formatted currency ($X.XX)
</verification>

<success_criteria>
- ItemsStep with mobile-optimized decimal price input (inputMode="decimal")
- Dollar-to-cents conversion uses Math.round (handles floating-point edge cases)
- BillWizard coordinates linear People -> Items flow
- Validation gates: 2+ people required, 1+ items to proceed
- Back/Next navigation functional
- Auto-advance past completed steps on page refresh
- Human verified the complete flow works on mobile viewport
</success_criteria>

<output>
After completion, create `.planning/phases/03-people-and-items-management/03-02-SUMMARY.md`
</output>
